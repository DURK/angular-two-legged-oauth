angular.module("angular-two-legged-oauth",[]).factory("twoLeggedOAuthInterceptor",["$q",function(a){var b=function(a){var b=a;if(-1!==b.indexOf("?")&&(b=b.substr(0,a.indexOf("?"))),0==a.indexOf("http://")||0==a.indexOf("https://"))return b;if(0==a.indexOf("/"))return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+b;throw"Unknown request scheme"},c=function(a){return encodeURIComponent(a)},d=function(a,b,d){var e=angular.copy(a);if(d&&-1!==d.indexOf("?")){var f=d.substr(d.indexOf("?")+1),g=f.split("&");g.forEach(function(a){if(a.indexOf("=")){var b=a.split("=");e[b[0]]=b[1]}})}if(b)for(var h=Object.keys(b),i=0;i<h.length;i++)e[h[i]]=b[h[i]];for(var j="",k=Object.keys(e).sort(),l=0;l<k.length;l++)""!=j&&(j+="&"),j+=c(k[l])+"="+c(e[k[l]]);return j},e=function(a,e,f,g){var h=c(a.method)+"&"+c(b(a.url))+"&"+c(d(f,a.params,a.url)),i="function"==typeof e.oauth_consumer_secret?e.oauth_consumer_secret(a):e.oauth_consumer_secret,j=c(i)+"&"+(e.oauth_token_secret?c(e.oauth_token_secret):"");return g(j,h)},f=function(a,b){for(var c={},d=Object.keys(a),e=0;e<d.length;e++){var f=a[d[e]];"function"==typeof f&&(f=f(b)),c[d[e]]=f}return c},g=function(a,b,d){for(var e='OAuth realm="'+c(a)+'"',f=Object.keys(d),g=0;g<f.length;g++)e+=", "+c(f[g])+'="'+c(d[f[g]])+'"';return e+=', oauth_signature="'+c(b)+'"'},h={request:function(b){if(null==h.filter||h.filter(b)){var c=f(h.configuration.options,b),d=e(b,h.configuration,c,h.configuration.signature_algorithm);null==b.headers&&(b.headers={}),b.headers.Authorization=g(h.configuration.realm,d,c)}return b||a.when(b)},configuration:{options:{oauth_timestamp:function(){return Math.round((new Date).getTime()/1e3)},oauth_nonce:function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;7>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}},signature_algorithm:function(a){return c(a)}}};return h}]);